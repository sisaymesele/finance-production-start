{% extends "dashboard.html" %}
{% load humanize %}

{% block content %}

<div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
    <h5 class="mb-3">Detailed Deduction By Adjusted Month</h5>

    <a href="{% url 'export_deduction_per_adjusted_month_to_excel' %}" class="btn btn-success btn-sm py-1 px-2">
        Export Deduction Adjustment to Excel
    </a>


    <form
            method="get"
            action="{% url 'deduction_per_adjusted_month' %}"
            class="d-flex mb-3"
            hx-get="{% url 'deduction_per_adjusted_month' %}"
            hx-target="#full-page-container"
            hx-trigger="keyup changed delay:800ms from:input[name='search']"
    >
        <input
                type="text"
                name="search"
                class="form-control me-2"
                placeholder="Search deduction per adjusted month..."
                value="{{ search_query|default_if_none:'' }}"
        >
        <button class="btn btn-primary" type="submit">Search</button>
    </form>
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead class="table-light">
        <tr>
            <th>Record Month</th>
            <th>Adjusted Month</th>
            <th>Personnel ID</th>
            <th>First Name</th>
            <th>Father Name</th>
            <th>Last Name</th>
            <th>Total Deduction</th>
        </tr>
        </thead>
        <tbody>
        {% for item in deduction_per_adjusted_month %}
        <tr>
            <td>{{ item.payroll_to_record__payroll_month__payroll_month__payroll_month }}</td>
            <td>{{ item.payroll_needing_adjustment__payroll_month__payroll_month__payroll_month }}</td>

            <td>{{ item.payroll_to_record__personnel_full_name__personnel_id }}</td>
            <td>{{ item.payroll_to_record__personnel_full_name__first_name }}</td>
            <td>{{ item.payroll_to_record__personnel_full_name__father_name }}</td>
            <td>{{ item.payroll_to_record__personnel_full_name__last_name }}</td>

            <td>{{ item.adjusted_month_total_deduction|default:"0.00"|floatformat:2|intcomma }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="11" class="text-center">No deduction adjustments found.</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}

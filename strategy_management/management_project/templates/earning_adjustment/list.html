{% extends "dashboard.html" %}
{% load humanize %}
{% block content %}
<div class="container-fluid mt-4">
    <!-- Messages -->
    {% for message in messages %}
    <p class="text-danger my-1">{{ message }}</p> {# smaller vertical margin #}
    {% endfor %}

    <!-- Header Actions -->
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2">

        <a href="{% url 'create_earning_adjustment' %}" class="btn btn-success"
           hx-get="{% url 'create_earning_adjustment' %}"
           hx-trigger="click"
           hx-target="#full-page-container"
           hx-swap="innerHTML"
           hx-push-url="true"
        >
            ‚ûï Create Earning Adjustment
        </a>

        <h2 class="fs-5 flex-grow-1 text-center text-md-start mb-0">Earning Adjustment List</h2>

        <a href="{% url 'export_earning_adjustment_list_to_excel' %}" class="btn btn-success btn-sm">
            üìÅ Export Earning Adjustment to Excel
        </a>


        <form
                method="get"
                action="{% url 'earning_adjustment_list' %}"
                class="d-flex mb-3"
                hx-get="{% url 'earning_adjustment_list' %}"
                hx-target="#full-page-container"
                hx-trigger="keyup changed delay:800ms from:input[name='search']"
        >
            <input
                    type="text"
                    name="search"
                    class="form-control me-2"
                    placeholder="Search individual earning..."
                    value="{{ search_query|default_if_none:'' }}"
            >
            <button class="btn btn-primary" type="submit">Search</button>
        </form>
    </div>

    <!-- Earnings Table -->
    <div class="table-responsive">
        <table class="table table-bordered table-striped table-sm">
            <thead class="table-dark">
            <tr>
                <th>#</th>
                <th>Record Month</th>
                <th>Adjusted Month</th>
                <th>First Name</th>
                <th>Father Name</th>
                <th>Last Name</th>
                <th>Case</th>
                <th>Component</th>
                <th>Earning Amount</th>
                <th>Taxable</th>
                <th>Non-Taxable</th>
                <th>Employee Pension</th>
                <th>Employer Pension</th>
                <th>Total Pension Contribution</th>

                <th>Period Start</th>
                <th>Period End</th>
                <th>Months Covered</th>
                <th>Created At</th>
                <th>Updated At</th>
                <th>Update</th>
                <th>Delete</th>
            </tr>
            </thead>
            <tbody>
            {% for ea in page_obj %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ ea.payroll_to_record.payroll_month.payroll_month.payroll_month }}</td>
                <td>{{ ea.payroll_needing_adjustment.payroll_month.payroll_month.payroll_month }}</td>
                <td>{{ ea.payroll_to_record.personnel_full_name.first_name }}</td>
                <td>{{ ea.payroll_to_record.personnel_full_name.father_name }}</td>
                <td>{{ ea.payroll_to_record.personnel_full_name.last_name }}</td>
                <td>{{ ea.get_case_display }}</td>
                <td>{{ ea.get_component_display }}</td>
                <td>{{ ea.earning_amount|default:"0.00"|floatformat:2|intcomma }}</td>
                <td>{{ ea.taxable|default:"0.00"|floatformat:2|intcomma }}</td>
                <td>{{ ea.non_taxable|default:"0.00"|floatformat:2|intcomma }}</td>
                <td>{{ ea.employee_pension_contribution|default:"0.00"|floatformat:2|intcomma }}</td>
                <td>{{ ea.employer_pension_contribution|default:"0.00"|floatformat:2|intcomma }}</td>
                <td>{{ ea.total_pension|default:"0.00"|floatformat:2|intcomma }}</td>
                <td>{{ ea.period_start }}</td>
                <td>{{ ea.period_end }}</td>
                <td>{{ ea.months_covered }}</td>
                <td>{{ ea.created_at }}</td>
                <td>{{ ea.updated_at }}</td>
                <td>
                    <a href="{% url 'update_earning_adjustment' ea.pk %}"
                       class="btn btn-warning"
                       hx-get="{% url 'update_earning_adjustment' ea.pk %}"
                       hx-trigger="click"
                       hx-target="#full-page-container"
                       hx-swap="innerHTML"
                       hx-push-url="true"
                    >
                        ‚úèÔ∏è
                    </a>
                </td>
                <td>
                    <a href="{% url 'delete_earning_adjustment' ea.pk %}"
                       class="btn btn-danger"
                       hx-get="{% url 'delete_earning_adjustment' ea.pk %}"
                       hx-trigger="click"
                       hx-target="#full-page-container"
                       hx-swap="innerHTML"
                       hx-push-url="true"
                    >
                        Ô∏è üóëÔ∏è
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="15">No earning adjustments found.</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div id="pagination">
        {% include 'pagination.html' %}
    </div>
</div>
{% endblock %}